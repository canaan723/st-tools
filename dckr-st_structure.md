# `dckr-st.sh` (咕咕助手) 完整菜单结构说明

本文档完整列出了脚本中所有的菜单层级及其对应功能介绍。

---

## 1. 主菜单 (Main Menu)
- **[1] 服务器初始化与安全加固**: 进入系统基础优化与安全增强模块。
- **[2] 应用部署中心**: 提供 Docker、1Panel 及各类应用的自动化安装。
- **[3] 应用运维管理**: 对已安装的 Docker 应用进行日常维护与配置修改。
- **[4] 系统安全与工具**: 包含防火墙管理、系统清理及各类测试工具。
- **[u] 检查更新**: 检查并在线升级脚本至最新版本。
- **[x] 卸载脚本**: 从系统中移除脚本命令。
- **[q] 退出脚本**: 结束脚本运行。

---

## 2. 服务器初始化与安全加固
- **[1] 一键全自动优化**: 顺序执行系统升级、BBR优化、Swap配置、时区设置及安全加固。
- **[2] 系统升级与内核优化**: 更新软件包并开启 BBR 拥塞控制与 Swap 虚拟内存。
- **[3] 设置系统时区**: 将系统时区统一设置为 Asia/Shanghai。
- **[4] 安装并启用 UFW 防火墙**: 安装 UFW 并配置基础安全规则。
- **[5] 修改 SSH 端口**: 自定义 SSH 连接端口并提供连接失败自动回滚保护。
- **[6] 安装进阶 Fail2ban**: 配置针对 SSH 爆破的自动化拦截与白名单机制。
- **[7] 立即重启服务器**: 执行系统重启以使内核优化生效。
- **[0] 返回上一级**: 返回主菜单。

---

## 3. 应用部署中心
- **[1] 安装 Docker**: 自动化安装 Docker 引擎及 Docker Compose。
- **[2] 安装 1Panel 面板**: 运行 1Panel 官方安装脚本（仅限 Debian/Ubuntu）。
- **[3] 部署 酒馆**: 自动化部署 SillyTavern 容器，支持单/多用户模式。
- **[4] 部署 gcli2api**: 自动化部署 gcli2api 接口转换工具。
- **[5] 部署 ais2api**: 自动化部署 ais2api 接口转换工具。
- **[0] 返回上一级**: 返回主菜单。

---

## 4. 应用运维管理
- **[1] 酒馆运维管理**: 进入 SillyTavern 专项管理菜单。
- **[2] gcli2api 运维管理**: 进入 gcli2api 专项管理菜单。
- **[3] ais2api 运维管理**: 进入 ais2api 专项管理菜单。
- **[4] 1Panel 运维管理**: 进入 1Panel 面板专项管理菜单。
- **[0] 返回上一级**: 返回主菜单。

### 4.1 酒馆运维管理 (SillyTavern)
- **[1] 重启酒馆**: 重新启动酒馆容器。
- **[2] 重建酒馆**: 强制重新创建容器以应用配置更改。
- **[3] 更新酒馆**: 拉取最新镜像并完成版本升级。
- **[4] 切换模式**: 在“单用户模式”与“多用户模式”之间进行切换。
- **[5] 配置修改**: 根据当前模式，提供“更改用户名密码”或“登录页美化开关”。
- **[6] 查看运行状态**: 显示容器的运行详情。
- **[7] 查看资源占用**: 实时监控容器的 CPU 和内存使用情况。
- **[8] 查看实时日志**: 滚动查看容器运行日志。
- **[x] 彻底卸载酒馆**: 停止容器并删除所有关联的项目数据。
- **[0] 返回上一级**: 返回应用运维管理菜单。

### 4.2 API 应用运维管理 (gcli2api / ais2api)
- **[1] 重启服务**: 重新启动对应的 API 容器。
- **[2] 重建服务**: 强制重新创建容器。
- **[3] 更新镜像**: 拉取最新镜像并重启。
- **[4] 查看运行状态**: 显示容器运行详情。
- **[5] 查看实时日志**: 滚动查看容器日志。
- **[x] 彻底卸载服务**: 停止容器并清理项目目录。
- **[0] 返回上一级**: 返回应用运维管理菜单。

### 4.3 1Panel 运维管理
- **[1] 查看面板状态与版本**: 显示 1Panel 服务运行情况。
- **[2] 获取面板登录信息**: 显示面板的访问地址及初始账号密码。
- **[3] 启动/停止/重启服务**: 管理 1Panel 核心服务的运行状态。
- **[4] 修改面板端口**: 更改面板访问端口并自动同步防火墙规则。
- **[5] 修改面板用户/密码**: 快速重置面板登录凭据。
- **[6] 重置安全设置**: 取消域名、入口、IP限制及 MFA 等安全锁定。
- **[7] 切换监听 IP**: 切换面板监听 IPv4 或 IPv6 地址。
- **[0] 返回上一级**: 返回应用运维管理菜单。

---

## 5. 系统安全与工具
- **[1] 测试脚本**: 进入流媒体及综合性能测试子菜单。
- **[2] API 接口连通性测试**: 测试 Gemini 或 OpenAI 接口的可用性。
- **[3] 系统安全清理**: 清理系统缓存与冗余日志。
- **[4] Fail2ban 运维管理**: 管理 IP 封禁报告与拦截规则。
- **[5] UFW 防火墙运维管理**: 管理本地防火墙规则与端口放行。
- **[0] 返回上一级**: 返回主菜单。

### 5.1 测试脚本子菜单
- **[1] Region 流媒体解锁测试**: 检测服务器对主流流媒体平台的解锁情况。
- **[2] NodeQuality 综合测试**: 运行服务器综合性能与网络质量测试。
- **[0] 返回上一级**: 返回系统安全与工具菜单。

### 5.2 API 接口连通性测试
- **[1] 测试 Gemini API**: 验证 Gemini API Key 的有效性及聊天功能。
- **[2] 测试 OpenAI API**: 验证自定义 OpenAI 接口的连通性。
- **[0] 返回上一级**: 返回系统安全与工具菜单。

### 5.3 Fail2ban 运维管理
- **[1] 查看详细封禁报告**: 显示当前各模块的封禁统计与 IP 列表。
- **[2] 查看实时拦截日志**: 实时监控 Fail2ban 的拦截动作。
- **[3] 手动解封被封 IP**: 从封禁名单中移除特定 IP。
- **[4] 手动封禁指定 IP**: 强制封禁特定恶意 IP。
- **[5] 修改封禁时长**: 调整拦截后的封禁时间（小时）。
- **[6] 重启 Fail2ban 服务**: 重新加载防护配置。
- **[7] 白名单管理**: 添加或移除不受拦截限制的 IP/CIDR。
- **[0] 返回上一级**: 返回系统安全与工具菜单。

### 5.4 UFW 防火墙运维管理
- **[1] 查看详细规则列表**: 以编号形式列出所有防火墙规则。
- **[2] 启用防火墙**: 开启 UFW 防火墙服务。
- **[3] 禁用防火墙**: 关闭 UFW 防火墙服务。
- **[4] 放行指定端口**: 手动开启特定的 TCP/UDP 端口。
- **[5] 删除指定规则**: 根据编号删除已有的防火墙规则。
- **[6] 查看被封禁 IP**: 显示由 Fail2ban 触发并同步到 UFW 的拦截记录。
- **[0] 返回上一级**: 返回系统安全与工具菜单。